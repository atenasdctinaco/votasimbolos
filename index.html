<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√≠mbolos Naturales | Municipio Tinaco</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png">
    
    <style>
        :root {
            --azul-tinaco: #1a2980; 
            --amarillo-tinaco: #feec42; 
            --blanco: #ffffff;
            --glass: rgba(255, 255, 255, 0.12); 
            --oro: #ffd700;
        }
        
        * { box-sizing: border-box; }
        
        body {
            margin: 0; font-family: 'Outfit', sans-serif;
            background: linear-gradient(135deg, var(--azul-tinaco) 0%, #26d0ce 100%);
            background-attachment: fixed; color: #fff; overflow-x: hidden;
        }

        .glass-card {
            background: var(--glass); backdrop-filter: blur(25px);
            border-radius: 30px; border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 25px 50px rgba(0,0,0,0.3); padding: 30px;
        }

        .screen { display: none; min-height: 100vh; padding: 40px 20px; box-sizing: border-box; }
        .active { display: flex; flex-direction: column; align-items: center; justify-content: center; animation: fadeIn 0.6s ease; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Acorde√≥n */
        .accordion { width: 100%; max-width: 600px; margin-top: 20px; text-align: left; }
        .acc-item { background: rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 10px; overflow: hidden; }
        .acc-header { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; font-weight: bold; background: rgba(255,255,255,0.1); }
        .acc-content { padding: 0 15px; max-height: 0; transition: 0.3s ease-out; font-size: 0.9rem; line-height: 1.5; color: #eee; }

        /* Inputs */
        .form-group { width: 100%; margin-bottom: 15px; text-align: left; }
        input, select {
            width: 100%; padding: 12px; margin-top: 5px; border-radius: 12px; border: none; box-sizing: border-box;
        }
        .disclaimer { font-size: 0.75rem; color: #ccc; margin-top: 5px; line-height: 1.2; }

        .btn-action {
            background: var(--amarillo-tinaco); 
            color: black; 
            border: none; 
            padding: 15px;
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: 700; 
            transition: 0.3s; 
            width: 100%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 10px;
            text-transform: uppercase; 
            text-decoration: none;
        }

        .chart-container-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
        }
        
        .chart-box {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 15px;
            width: 100%; /* Ocupa todo el ancho en m√≥vil */
            max-width: 400px; /* Tama√±o m√°ximo en PC */
            min-height: 350px;
        }
        .btn-action:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }

        .grid-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; width: 100%; max-width: 1200px; }
        .img-container { width: 100%; height: 180px; background: rgba(0,0,0,0.3); border-radius: 15px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .img-container img { max-width: 100%; max-height: 100%; object-fit: contain; }

        footer { text-align: center; padding: 40px; background: rgba(0,0,0,0.3); margin-top: 40px; font-size: 0.85rem; }
        footer img { width: 60px; border-radius: 50%; border: 2px solid #fff; margin-bottom: 10px; }

        /* Estilo para el logo flotante dentro de las tarjetas */
        .glass-card { position: relative; overflow: hidden; } /* Asegura que el logo no se salga */
        
        .brand-float {
            position: absolute;
            bottom: 10px;
            right: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0.6; /* Un poco transparente para no distraer */
        }
        
        .brand-float img { width: 25px; height: auto; }
        .brand-float span { font-size: 0.65rem; color: #fff; font-weight: 300; }
    </style>
</head>
<body>

<section id="screen-intro" class="screen active">
    <div class="glass-card" style="max-width: 700px; text-align: center;">
        <img src="https://i.ibb.co/GvJh9bVz/Logo-Tinaco01.png" alt="Alcald√≠a de Tinaco" style="width: 100%; max-width: 250px; margin-bottom: 15px;">
        <h1 style="font-size: 2.5rem; margin: 10px 0;">Identidad Natural</h1>
        <p>Participa en la elecci√≥n de los S√≠mbolos Naturales de nuestra tierra.</p>
        
        <div class="accordion">
            <div class="acc-item">
                <div class="acc-header" onclick="toggleAcc(this)">ANTECEDENTES DEL PROYECTO <i class="fas fa-chevron-down"></i></div>
                <div class="acc-content">
                    <p>El Municipio Tinaco busca fortalecer su identidad local a trav√©s de la elecci√≥n democr√°tica de su Ave y Flor emblem√°tica. Este proceso permite que el ciudadano se apropie de su patrimonio natural y reconozca la biodiversidad que nos rodea.</p>
                    <div style="padding: 20px; text-align: left; font-size: 0.9rem;">
                        <p>üî∞ <b>Comisi√≥n de Preservaci√≥n:</b> Iniciamos con una comisi√≥n t√©cnica para identificar especies que representan nuestras fortalezas.</p>
                        <p>üî∏ <b>Consulta Popular:</b> Realizamos encuestas en 40 sectores (urbanos y rurales) con una muestra de 226 personas.</p>
                        <p>üî∏ <b>√Årbol Emblem√°tico:</b> El <b>Roble Criollo</b> fue el ganador indiscutible por su fortaleza y belleza.</p>
                        <p>üî∏ <b>Sobre la Flor:</b> Se detect√≥ que muchas flores de nuestros jardines no son aut√≥ctonas. Por eso, abrimos esta nueva consulta t√©cnica.</p>
                        <p>üî∏ <b>Sobre el Ave:</b> Aunque la Paraulata fue mencionada, ya representa a otro estado. Buscamos autenticidad y diferenciaci√≥n para Tinaco.</p>
                        <p>¬°Tu opini√≥n hoy definir√° nuestra identidad para las futuras generaciones!</p>
                    </div>
                </div>
            </div>
        </div>

        <br>
        <button class="btn-action" onclick="nextScreen('screen-form')">EMPEZAR VOTACI√ìN</button>
        </br>
        <div class="brand-float">
            <span>Consulta ciudadana 2026 | S√≠mbolos Naturales</span>
            <img src="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png" alt="ico">
        </div>
    </div>
</section>

<section id="screen-form" class="screen">
    <div class="glass-card" style="max-width: 500px; width: 90%;">
        <h2 style="text-align: center;">Registro</h2>
        <div class="form-group"><label>C√©dula *</label><input type="number" id="v-ci"></div>
        <div class="form-group"><label>Nombre Completo *</label><input type="text" id="v-nombre"></div>
        <div class="form-group"><label>Correo Electr√≥nico *</label>
            <input type="email" id="v-email" placeholder="ejemplo@correo.com">
            <p class="disclaimer">Se usar√° para dar a conocer los resultados y registrarle en la Revista de divulgaci√≥n educativa, cient√≠fica y cultural Epistecnolog√≠a.</p>
        </div>
        <div style="display: flex; gap:10px;">
            <div class="form-group"><label>Edad</label><input type="number" id="v-edad"></div>
            <div class="form-group"><label>G√©nero</label><select id="v-genero"><option value="F">F</option><option value="M">M</option></select></div>
        </div>
        <div class="form-group"><label>Sector *</label><input type="text" id="v-sector"></div>
        <button class="btn-action" onclick="validateForm()">CONTINUAR</button>
        </br>
        <div class="brand-float">
            <span>Consulta ciudadana 2026 | S√≠mbolos Naturales</span>
            <img src="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png" alt="ico">
        </div>
    </div>
</section>

<section id="screen-selector" class="screen">
    <h2 style="text-align: center;">Seleccione Categor√≠a</h2>
    <div class="grid-cards" style="max-width: 700px;">
        <div class="glass-card" style="text-align:center; cursor:pointer;" onclick="renderVotacion('aves')">
            <i class="fas fa-feather-alt fa-4x" style="color:var(--oro)"></i><h3>AVES</h3>
            <div id="check-ave" style="display:none; color:#00ff00;">‚úÖ ELEGIDO</div>
        </div>
        <div class="glass-card" style="text-align:center; cursor:pointer;" onclick="renderVotacion('flores')">
            <i class="fas fa-seedling fa-4x" style="color:var(--oro)"></i><h3>FLORES</h3>
            <div id="check-flor" style="display:none; color:#00ff00;">‚úÖ ELEGIDO</div>
        </div>
        </br>
        <div class="brand-float">
            <span>Consulta ciudadana 2026 | S√≠mbolos Naturales</span>
            <img src="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png" alt="ico">
        </div>
    </div>
</section>

<section id="screen-voting" class="screen">
    <h2 id="vote-title"></h2>
    <div class="grid-cards" id="container-voting"></div>
</section>

<section id="screen-thanks" class="screen">
    <div class="glass-card" style="max-width: 500px; text-align: center;">
        <div id="processing-box">
            <i class="fas fa-spinner fa-spin fa-3x"></i>
            <h3>Gracias por participar. Enviando tu voto...</h3>
            </br>
        <div class="brand-float">
            <span>Consulta ciudadana 2026 | S√≠mbolos Naturales</span>
            <img src="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png" alt="ico">
        </div>
        </div>
        <div id="subscribe-box" style="display:none;">
            <i class="fas fa-check-circle fa-4x" style="color:#27ae60"></i>
            <h2>¬°Voto registrado!</h2>
            <p>Para ver los resultados en vivo y apoyar el proyecto:</p>
            
            <p style="color:var(--oro); font-weight:bold; margin:15px 0;">
                1. Suscr√≠bete al canal <br> 
                2. Regresa a esta pesta√±a para ver como van los resultados
            </p>
            
            <div style="padding: 0 10px;"> <a href="https://www.youtube.com/@epistecnologia?sub_confirmation=1" target="_blank" class="btn-action" style="background:#ff0000;" onclick="showResultsBtn()">
                    <i class="fab fa-youtube"></i> SUSCRIBIRSE
                </a>
            </div>
            <br>
            <button id="btn-ver-resultados" class="btn-action" style="background:var(--azul-tinaco); display:none;" onclick="mostrarResultadosFinales()">
                VER RESULTADOS EN VIVO
            </button>
        </div>
        </br>
        <div class="brand-float">
            <span>Consulta ciudadana 2026 | S√≠mbolos Naturales</span>
            <img src="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png" alt="ico">
        </div>
    </div>
</section>

<section id="screen-results" class="screen">
    <div class="glass-card" style="width: 95%; max-width: 800px; text-align:center; padding-bottom: 40px;">
        
        <img src="https://i.ibb.co/GvJh9bVz/Logo-Tinaco01.png" alt="Alcald√≠a" style="width: 180px; margin-bottom: 20px;">
        
        <h2 style="color:var(--oro); margin-top:0;">¬°Gracias por participar!</h2>
        
        <p style="font-size: 1rem; line-height: 1.5; color: #eee; margin-bottom: 25px; padding: 0 15px;">
            Desde la <b>Alcald√≠a de Tinaco</b> te pedimos invitar a otros a participar en esta consulta que fortalecer√° nuestra identidad. ¬°Tu voz es nuestro futuro!
        </p>

        <div class="chart-container-wrapper">
            <div class="chart-box"><canvas id="chartAves"></canvas></div>
            <div class="chart-box"><canvas id="chartFlores"></canvas></div>
        </div>

        <div style="margin-top: 30px; display: flex; flex-direction: column; gap: 15px; align-items: center;">
            <button class="btn-action" style="background:#25d366; max-width: 300px;" onclick="invitarAmigos()">
                <i class="fas fa-share-alt"></i> INVITAR A OTROS
            </button>
            
            <button onclick="location.reload()" style="background: transparent; border: 1px solid #fff; color: #fff; padding: 10px 20px; border-radius: 15px; cursor: pointer; font-size: 0.8rem;">
                CERRAR Y VOLVER AL INICIO
            </button>
        </div>
        </br>
        <div class="brand-float">
            <span>Resultados de la consulta 2026 | S√≠mbolos Naturales</span>
            <img src="https://i.ibb.co/Pzw26hzh/Logo-Tinaco02.png" alt="ico">
        </div>
    </div>
</section>

<footer>
    <img src="https://i.ibb.co/hFRyKrxY/logo-epist-v3-1x1-c.png" alt="Logo" onclick="accesoSecreto()" style="cursor: pointer;">
    <p>Desarrollado por <a href="https://epistecnologia.com/" target="_blank" style="color:var(--oro)">Epistecnolog√≠a</a></p>
    <p>Una plataforma y revista de divulgaci√≥n cient√≠fica y culturas, del tinaquero <a href="https://epistecnologia.com/@henry" target="_blank" style="color:var(--oro)">Henry Adolfo M√°rquez Mercado</a></p>
</footer>

<script>
    const S_URL = "https://rccwtttftdgpbzkromux.supabase.co";
    const S_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJjY3d0dHRmdGRncGJ6a3JvbXV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIwMzk0MDQsImV4cCI6MjA4NzYxNTQwNH0.W1qs1oF3IbVM7Uph2wKKIJs-W09uNwwhJ2TFFpdT3n4"; 
    const _supabase = supabase.createClient(S_URL, S_KEY);

    const dataAves = [
        {nombre: 'Carpintero', img: 'https://i.ibb.co/kg3YG0dP/large.jpg', desc: 'Ingeniero forestal natural.'},
        {nombre: 'Sangre toro', img: 'https://i.ibb.co/NnGg1Q86/900.jpg', desc: 'Vitalidad y pasi√≥n llanera.'},
        {nombre: 'CristoFue', img: 'https://i.ibb.co/nNLYqT3M/900.jpg', desc: 'El vigilante de nuestros patios.'},
        {nombre: 'El Gaban', img: 'https://i.ibb.co/HTL8cxgG/43dac00274fc4fe2e1f4ced2ce7f8459.jpg', desc: 'Elegancia de los esteros.'},
        {nombre: 'Alcaravan', img: 'https://inaturalist-open-data.s3.amazonaws.com/photos/135057906/large.jpeg', desc: 'Guardi√°n de la sabana.'}
    ];

    const dataFlores = [
        {nombre: 'Lirio Sabanero', img: 'https://i.ibb.co/Zz4Rwj1j/Lirio-Sabanero.jpg', desc: 'Resiliencia llanera.'},
        {nombre: 'Ruellia', img: 'https://i.ibb.co/Sw52WZbc/960px-Ruellia-simplex-02.jpg', desc: 'Belleza silvestre.'},
        {nombre: 'Bototo', img: 'https://i.ibb.co/KzzmNF9b/Bototo.jpg', desc: 'El oro del llano.'},
        {nombre: 'Nazareno', img: 'https://i.ibb.co/wmfqWGG/shutterstock-1056956174.jpg', desc: 'Espiritualidad p√∫rpura.'},
        {nombre: 'Cimbra potro', img: 'https://i.ibb.co/WpF8WZDp/Dt-EJcyi-XQAAr-Y8.jpg', desc: 'Esencia del ecosistema.'},
    ];

    let userVoto = { ci: '', nombre: '', email: '', ave: null, flor: null };

    function toggleAcc(el) {
        const content = el.nextElementSibling;
        content.style.maxHeight = content.style.maxHeight ? null : content.scrollHeight + "px";
    }

    function nextScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0,0);
    }

    function validateForm() {
        userVoto.ci = document.getElementById('v-ci').value;
        userVoto.nombre = document.getElementById('v-nombre').value;
        userVoto.email = document.getElementById('v-email').value;
        if(!userVoto.ci || !userVoto.nombre || !userVoto.email) return alert("Por favor complete los campos obligatorios.");
        nextScreen('screen-selector');
    }

    function renderVotacion(tipo) {
        const container = document.getElementById('container-voting');
        const lista = tipo === 'aves' ? dataAves : dataFlores;
        document.getElementById('vote-title').innerText = "ELIGE TU " + tipo.toUpperCase();
        container.innerHTML = '';
        lista.forEach(item => {
            const card = document.createElement('div');
            card.className = "glass-card";
            card.innerHTML = `
                <div class="img-container"><img src="${item.img}"></div>
                <h3 style="color:var(--oro);">${item.nombre}</h3>
                <p style="font-size:0.85rem; min-height:40px;">${item.desc}</p> <button class="btn-action" onclick="setVoto('${tipo}', '${item.nombre}')">SELECCIONAR</button>
            `;
            container.appendChild(card);
        });
        nextScreen('screen-voting');
    }

    function setVoto(tipo, nombre) {
        if(tipo === 'aves') { userVoto.ave = nombre; document.getElementById('check-ave').style.display='block'; }
        else { userVoto.flor = nombre; document.getElementById('check-flor').style.display='block'; }
        
        if(userVoto.ave && userVoto.flor) {
            nextScreen('screen-thanks');
            enviarASupabase();
        } else {
            nextScreen('screen-selector');
        }
    }

    async function enviarASupabase() {
        const { error } = await _supabase.from('votos').insert([{
            cedula: userVoto.ci, nombre_completo: userVoto.nombre, email: userVoto.email,
            voto_ave: userVoto.ave, voto_flor: userVoto.flor,
            sector: document.getElementById('v-sector').value,
            edad: document.getElementById('v-edad').value,
            genero: document.getElementById('v-genero').value
        }]);

        if(error) {
            alert("Error: " + error.message);
            nextScreen('screen-form');
        } else {
            document.getElementById('processing-box').style.display = 'none';
            document.getElementById('subscribe-box').style.display = 'block';
        }
    }

    function showResultsBtn() {
        setTimeout(() => {
            document.getElementById('btn-ver-resultados').style.display = 'flex';
        }, 2000);
    }

    function mostrarResultadosFinales() {
        nextScreen('screen-results');
        mostrarEstadisticas();
    }

    async function mostrarEstadisticas() {
        const { data } = await _supabase.from('votos').select('voto_ave, voto_flor');
        const counts = (arr, key) => arr.reduce((a, c) => (a[c[key]] = (a[c[key]] || 0) + 1, a), {});
        
        const avesMap = counts(data || [], 'voto_ave');
        const floresMap = counts(data || [], 'voto_flor');
    
        // Gr√°fico de Aves (Circular - Se lee bien en cualquier lado)
        new Chart(document.getElementById('chartAves'), {
            type: 'doughnut',
            data: {
                labels: Object.keys(avesMap),
                datasets: [{
                    data: Object.values(avesMap),
                    backgroundColor: ['#1a2980', '#ff0000', '#ffd700', '#27ae60', '#8e44ad'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { color: '#fff', padding: 20 } },
                    title: { display: true, text: 'PREFERENCIA DE AVES', color: '#ffd700', font: { size: 16, weight: 'bold' } }
                }
            }
        });
    
        // Gr√°fico de Flores (Barras Horizontales - LA MEJOR SOLUCI√ìN)
        new Chart(document.getElementById('chartFlores'), {
            type: 'bar',
            data: {
                labels: Object.keys(floresMap),
                datasets: [{
                    label: 'Votos',
                    data: Object.values(floresMap),
                    backgroundColor: '#feec42',
                    borderRadius: 10
                }]
            },
            options: {
                indexAxis: 'y', // <--- ESTO LO HACE HORIZONTAL
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    title: { display: true, text: 'VOTOS POR FLOR', color: '#ffd700', font: { size: 16, weight: 'bold' } }
                },
                scales: {
                    x: { 
                        beginAtZero: true, 
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        ticks: { color: '#fff', stepSize: 1 } 
                    },
                    y: { 
                        grid: { display: false },
                        ticks: { color: '#fff', font: { size: 12 } } 
                    }
                }
            }
        });
    }
    // Acceso para gestores: Si presionan la tecla "A" may√∫scula en el inicio
    document.addEventListener('keydown', (e) => {
        if(e.key === 'A' && document.getElementById('screen-intro').classList.contains('active')) {
            const pass = prompt("Acceso Administrativo. Ingrese contrase√±a:");
            if(pass === "tinaco2026") { // Cambia esta clave
                mostrarResultadosFinales();
            }
        }
    });

    let toquesAdmin = 0;

    function accesoSecreto() {
        toquesAdmin++;
        
        // Si llega a 5 toques
        if (toquesAdmin === 5) {
            const pass = prompt("Acceso Administrativo. Ingrese contrase√±a:");
            
            if (pass === "tinaco2026") { // Aqu√≠ pones tu clave
                mostrarResultadosFinales();
            } else {
                alert("Clave incorrecta");
            }
            
            // Reiniciamos el contador despu√©s del intento
            toquesAdmin = 0; 
        }
    
        // Si deja de tocar por 3 segundos, se reinicia el contador por seguridad
        setTimeout(() => { toquesAdmin = 0; }, 3000);
    }

    function invitarAmigos() {
    const textoCompartir = "¬°Hola! Te invito a participar en la elecci√≥n de los S√≠mbolos Naturales de nuestro Municipio Tinaco. ¬°Tu voto cuenta para nuestra identidad! Vota aqu√≠: ";
    const url = window.location.href;

    if (navigator.share) {
        // Esto abre el men√∫ nativo del celular (WhatsApp, Instagram, etc.)
        navigator.share({
            title: 'S√≠mbolos Naturales Tinaco',
            text: textoCompartir,
            url: url,
        }).catch(console.error);
    } else {
        // Opci√≥n de respaldo si el navegador no soporta compartir (PC antiguas)
        alert("Copia y comparte este enlace: " + url);
    }
}
</script>
</body>
</html>
